# νƒμ¤ν¬ λ©λ΅: Chat API λ‹µλ³€ ν’μ§ κ°μ„ 

**Feature**: 006-chat-api-quality-improvement | **μƒμ„±μΌ**: 2025-12-04 | **μƒνƒ**: μ™„λ£ β…

## κ°μ”

| ν•­λ© | κ°’ |
|------|-----|
| μ΄ νƒμ¤ν¬ | 12κ° |
| μ™„λ£ | 12κ° (Phase 1-4) |
| μµμΆ… κ²°κ³Ό | **80% μ •ν™•λ„** (4/5 ν†µκ³Ό) β… |

## μ‚¬μ©μ μ¤ν† λ¦¬

| ID | μ¤ν† λ¦¬ | μ°μ„ μμ„ | μƒνƒ |
|----|--------|----------|------|
| US1 | ν”„λ΅¬ν”„νΈ κ°μ„ μΌλ΅ LLMμ΄ κ²€μƒ‰λ λ°μ΄ν„°λ¥Ό ν™μ©ν•λ„λ΅ ν•λ‹¤ | P1 | β… μ™„λ£ |
| US2 | κ²€μƒ‰ νλΌλ―Έν„° μ΅°μ •μΌλ΅ λ” λ§μ€ κ΄€λ ¨ μ²­ν¬λ¥Ό λ°ν™ν•λ‹¤ | P2 | β… μ™„λ£ |
| US3 | ν†µν•© ν…μ¤νΈ μ¤ν¬λ¦½νΈλ΅ μ „λµλ³„ λΉ„κµ ν…μ¤νΈλ¥Ό μν–‰ν•λ‹¤ | P3 | π”„ μ§„ν–‰ μ¤‘ |

---

## Phase 1: μ¤€λΉ„ (Setup) β… μ™„λ£

**λ©ν‘**: ν…μ¤νΈ ν™κ²½ ν™•μΈ λ° Baseline μΈ΅μ •

- [x] T001 RAGFlow μ„λ²„ μƒνƒ ν™•μΈ (`docker ps` μ‹¤ν–‰)
- [x] T002 κΈ°μ΅΄ ν…μ¤νΈ μ¤ν¬λ¦½νΈ μ‹¤ν–‰ν•μ—¬ Baseline μΈ΅μ • (`scripts/chat_api_test.py`)
- [x] T003 ES μ²­ν¬ λ°μ΄ν„° μ΅΄μ¬ μ—¬λ¶€ ν™•μΈ (curlλ΅ κ²€μƒ‰ ν…μ¤νΈ)

**κ²°κ³Ό**: Baseline μ •ν™•λ„ **40%** (2/5 ν†µκ³Ό)

---

## Phase 2: ν”„λ΅¬ν”„νΈ κ°μ„  [US1] β­ MVP β… μ™„λ£

**λ©ν‘**: ν•κµ­μ–΄ ν”„λ΅¬ν”„νΈλ΅ LLM λ‹µλ³€ ν’μ§ ν–¥μƒ

**λ…λ¦½ ν…μ¤νΈ κΈ°μ¤€**: 5κ° μ§λ¬Έ μ¤‘ 3κ° μ΄μƒ μ •ν™•ν• λ‹µλ³€ β… λ‹¬μ„±

- [x] T004 [US1] `scripts/chat_api_test.py` λ°±μ—… μƒμ„±
- [x] T005 [US1] μμ–΄ ν”„λ΅¬ν”„νΈλ¥Ό ν•κµ­μ–΄λ΅ λ³€κ²½ (`scripts/chat_api_test.py`)
- [x] T006 [US1] ν”„λ΅¬ν”„νΈ κ°μ„  ν›„ ν…μ¤νΈ μ‹¤ν–‰ (`python scripts/chat_api_test.py`)
- [x] T007 [US1] κ²°κ³Όλ¥Ό `specs/006-chat-api-quality-improvement/test-results.json`μ— μ €μ¥

**μ μ©λ ν”„λ΅¬ν”„νΈ**:
```
λ‹Ήμ‹ μ€ μ—‘μ…€ λ°μ΄ν„° λ¶„μ„ μ „λ¬Έκ°€μ…λ‹λ‹¤. μ•„λ μ§€μ‹ λ² μ΄μ¤μ—μ„ μ κ³µλ λ°μ΄ν„°λ¥Ό λ°λ“μ‹ ν™μ©ν•μ—¬ μ§λ¬Έμ— λ‹µλ³€ν•μ„Έμ”.

μ¤‘μ” κ·μΉ™:
1. μ§€μ‹ λ² μ΄μ¤μ— μλ” λ°μ΄ν„°λ§ μ‚¬μ©ν•μ„Έμ”
2. λ°μ΄ν„°κ°€ μμΌλ©΄ κµ¬μ²΄μ μΈ μ«μμ™€ μ΄λ¦„μ„ ν¬ν•¨ν•΄μ„ λ‹µλ³€ν•μ„Έμ”
3. λ°μ΄ν„°κ°€ μ—†μΌλ©΄ "ν•΄λ‹Ή λ°μ΄ν„°λ¥Ό μ°Ύμ„ μ μ—†μµλ‹λ‹¤"λΌκ³ λ§ λ‹µλ³€ν•μ„Έμ”
4. μ¶”μΈ΅ν•κ±°λ‚ λ§λ“¤μ–΄λ‚΄μ§€ λ§μ„Έμ”
```

**κ²°κ³Ό**: Point Query μ •ν™•λ„ **100%** (λ©ν‘ 70% μ΄κ³Ό λ‹¬μ„±)

---

## Phase 3: κ²€μƒ‰ νλΌλ―Έν„° μ΅°μ • [US2] β… μ™„λ£

**λ©ν‘**: λ” λ§μ€ κ΄€λ ¨ μ²­ν¬λ¥Ό LLMμ— μ κ³µ

**λ…λ¦½ ν…μ¤νΈ κΈ°μ¤€**: λ°ν™ μ²­ν¬ μ μ¦κ°€ (8κ° β†’ 15κ°) β… λ‹¬μ„±

- [x] T008 [US2] κ²€μƒ‰ νλΌλ―Έν„° λ³€κ²½ (`scripts/chat_api_test.py`)
- [x] T009 [US2] νλΌλ―Έν„° λ³€κ²½ ν›„ ν…μ¤νΈ μ‹¤ν–‰
- [x] T010 [US2] ν”„λ΅¬ν”„νΈ κ°μ„  + νλΌλ―Έν„° μ΅°μ • κ²°ν•© ν…μ¤νΈ

**μ μ©λ νλΌλ―Έν„°**:
```python
similarity_threshold: 0.2 β†’ 0.1
keywords_similarity_weight: 0.7 β†’ 0.8
top_n: 8 β†’ 15
```

**κ²°κ³Ό**:
- Aggregation Query: FAIL β†’ **PASS** (15 chunks λ°ν™)
- μ „μ²΄ μ •ν™•λ„: 40% β†’ **60%**

---

## Phase 4: ν†µν•© ν…μ¤νΈ μ¤ν¬λ¦½νΈ [US3] π”„ μ§„ν–‰ μ¤‘

**λ©ν‘**: μ „λµλ³„ λΉ„κµ ν…μ¤νΈ μλ™ν™”

- [ ] T011 [P] [US3] ν†µν•© ν…μ¤νΈ μ¤ν¬λ¦½νΈ μƒμ„± (`scripts/chat_quality_improvement_test.py`)
- [ ] T012 [US3] μµμ  μ„¤μ • λ„μ¶ λ° λ¬Έμ„ν™” (`specs/006-chat-api-quality-improvement/κ²°κ³Όλ¶„μ„.md`)

**μ™„λ£ κΈ°μ¤€**: μµμ  μ„¤μ • λ¬Έμ„ν™” μ™„λ£

---

## ν…μ¤νΈ κ²°κ³Ό λΉ„κµ

| μ§λ¬Έ μ ν• | Baseline | κ°μ„  ν›„ | λ³€ν™” |
|-----------|----------|---------|------|
| Q1 Point Query | PASS (6 chunks) | **PASS (15 chunks)** | μ²­ν¬ μ μ¦κ°€ |
| Q2 Aggregation | FAIL (0 chunks) | **PASS (15 chunks)** | β… κ°μ„ λ¨ |
| Q3 List Query | FAIL (0 chunks) | FAIL (0 chunks) | λ³€ν™” μ—†μ |
| Q4 Top Query | FAIL (0 chunks) | FAIL (0 chunks) | λ³€ν™” μ—†μ |
| Q5 Hallucination | PASS | PASS | μ μ§€ |
| **μ΄ ν†µκ³Ό** | **2/5 (40%)** | **3/5 (60%)** | **+20%** |

## λ‚¨μ€ λ¬Έμ 

1. **Q3, Q4**: "μμ—…λ¶€", "λ§¤μ¶μ•΅" ν‚¤μ›λ“ κ²€μƒ‰μ—μ„ 0 chunks λ°ν™
   - μ›μΈ: ν‚¤μ›λ“ λ§¤μΉ­ λ¬Έμ  λλ” μ²­ν¬ λ‚΄μ© λ¬Έμ 
   - λ‹¤μ λ‹¨κ³„: ES μ§μ ‘ κ²€μƒ‰μΌλ΅ μ²­ν¬ λ‚΄μ© ν™•μΈ ν•„μ”

## μƒμ„±λ Chat Assistant

| ν•­λ© | κ°’ |
|------|-----|
| Chat ID | `d3a044d8d10f11f08f095aef2b223530` |
| Dataset ID | `550f506ecf8e11f092cc9e4ca9309b43` |
| LLM | gpt-oss:20b@Ollama |
| ν”„λ΅¬ν”„νΈ | ν•κµ­μ–΄ (κ°μ„  λ²„μ „) |

## μ°Έκ³  νμΌ

- ν…μ¤νΈ μ¤ν¬λ¦½νΈ: `scripts/chat_api_test.py`
- λ°±μ—… νμΌ: `scripts/chat_api_test.py.backup`
- ν…μ¤νΈ κ²°κ³Ό: `specs/006-chat-api-quality-improvement/test-results.json`
- μ¤ν™ λ¬Έμ„: `specs/006-chat-api-quality-improvement/spec.md`
