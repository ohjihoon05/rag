# Phase 5: 한국어 Q&A 인터페이스 테스트 가이드

**목표**: bge-m3 임베딩을 사용한 한국어 질의응답 시스템 검증

---

## 자동 테스트 실행 (권장)

### 방법 1: Python 스크립트 사용

```bash
cd /c/Users/ohjh/ragflow
python scripts/phase5_test_korean_qa.py
```

스크립트가 다음을 자동으로 테스트합니다:
- ✅ T022: Chat 생성 및 Knowledge Base 연결
- ✅ T023: 시스템 프롬프트 설정
- ✅ T024: Chat 파라미터 설정
- ✅ T025: 한국어 Q&A 테스트
- ✅ T026: Edge case 테스트
- ✅ T027: 출처 확인

**필요사항**: RAGFlow API 키 (아래 참조)

---

## 수동 테스트 (UI 사용)

### 사전 준비

1. **RAGFlow 접속**
   - 브라우저에서 http://localhost 접속
   - 로그인

2. **API 키 생성** (자동 스크립트 사용 시)
   - 우측 상단 프로필 클릭
   - "API Keys" 메뉴 선택
   - "Create new key" 클릭
   - 생성된 키 복사 및 저장

---

### T022: Chat 생성 및 Knowledge Base 연결

**단계**:
1. 좌측 메뉴에서 **"Chat"** 클릭
2. **"+ New Chat"** 버튼 클릭
3. Chat 설정:
   - **Name**: `한국어 Q&A 테스트`
   - **Knowledge Base**: "CS 데일리 리포트" 선택 (또는 생성된 KB)
4. **"Create"** 클릭

**검증**:
- ✅ Chat이 생성되고 Knowledge Base에 연결됨
- ✅ Chat 화면에서 Knowledge Base 이름 표시됨

---

### T023: 시스템 프롬프트 설정

**단계**:
1. 생성된 Chat에서 **설정(⚙️)** 아이콘 클릭
2. **"System"** 또는 **"Prompt"** 탭 선택
3. 시스템 프롬프트 입력:

```
문서에 있는 내용만 사용하여 답변하세요.
정보가 없으면 '문서에서 찾을 수 없습니다'라고 답변하세요.
답변 시 반드시 참조한 문서의 출처를 명시하세요.
```

4. **"Save"** 클릭

**검증**:
- ✅ 시스템 프롬프트가 한국어로 설정됨
- ✅ 문서 기반 답변 규칙 명시됨

---

### T024: Chat 파라미터 설정

**단계**:
1. Chat 설정에서 **"Model"** 또는 **"Parameters"** 탭 선택
2. 파라미터 설정:
   - **LLM Model**: `qwen2.5:7b` (Ollama)
   - **Temperature**: `0.1` (환각 최소화)
   - **Top K**: `5` (상위 5개 청크 검색)
   - **Top P**: `0.3`
   - **Max Tokens**: `512`
3. Retrieval 설정:
   - **Similarity Threshold**: `0.2`
   - **Top N**: `5` (3-5 청크 검색)
   - **Rerank Model**: `BAAI/bge-reranker-v2-m3`
4. **"Save"** 클릭

**검증**:
- ✅ Temperature가 낮게 설정됨 (환각 방지)
- ✅ Top K가 3-5로 설정됨
- ✅ Reranker가 활성화됨

---

### T025: 한국어 Q&A 테스트

**단계**:
1. Chat 화면으로 돌아가기
2. 다음 질문들을 순차적으로 입력:

#### 테스트 질문 1
```
문서의 주요 내용이 무엇인가요?
```

**검증**:
- ✅ 응답이 5초 이내에 생성됨
- ✅ 응답이 업로드한 문서 내용을 기반으로 함
- ✅ 환각(hallucination) 없음

#### 테스트 질문 2
```
고객 문의 중 가장 많았던 이슈는 무엇인가요?
```

**검증**:
- ✅ 문서에서 관련 정보 추출
- ✅ 한국어로 정확한 답변 생성

#### 테스트 질문 3
```
어떤 문제들이 언급되어 있나요?
```

**검증**:
- ✅ 문서 내용 요약 제공
- ✅ 구체적인 정보 포함

---

### T026: Edge Case 테스트 (답변 불가능한 질문)

**단계**:
1. 문서에 없는 정보를 묻는 질문 입력:

```
내일 날씨가 어떻게 되나요?
```

**검증**:
- ✅ "문서에서 찾을 수 없습니다" 응답 반환
- ✅ 환각된 답변 생성하지 않음
- ✅ 시스템 프롬프트 규칙 준수

---

### T027: 출처 확인

**단계**:
1. 이전 답변들에서 **"Sources"** 또는 **"References"** 섹션 확인
2. 각 답변에 대해 검증:

**검증**:
- ✅ 참조된 문서 청크가 표시됨
- ✅ 문서 이름과 페이지 정보 포함
- ✅ 청크 내용 미리보기 가능
- ✅ 3-5개의 관련 청크가 검색됨

**예상 출력**:
```
📚 출처:
  1. sample_korean_document.txt: "고객 문의 내용..."
  2. sample_korean_document.txt: "주요 이슈 사항..."
  3. sample_korean_document.txt: "해결 방안..."
```

---

## 성공 기준 체크리스트

### 기능 검증
- [ ] Chat이 Knowledge Base에 연결됨
- [ ] 한국어 질문에 한국어로 응답
- [ ] 문서 기반 답변 생성 (환각 없음)
- [ ] 응답 시간 < 5초
- [ ] 출처가 명확하게 표시됨
- [ ] 답변 불가능 시 적절한 응답

### 성능 검증
- [ ] 평균 응답 시간 < 5초
- [ ] 메모리 사용량 < 12GB (docker stats로 확인)
- [ ] 서비스 안정성 (오류 없음)

### 품질 검증
- [ ] 검색 정확도: 상위 3개 결과 중 관련 청크 포함
- [ ] 답변 정확도: 문서 내용과 일치
- [ ] 한국어 품질: 자연스러운 한국어 답변

---

## 성능 모니터링

### 응답 시간 확인
```bash
# 브라우저 개발자 도구에서 확인
# Network 탭 → completions API 호출 → Timing 확인
```

### 메모리 사용량 확인
```bash
cd docker
docker stats --no-stream | grep -E "ragflow|mysql|infinity|redis|minio"
```

### 로그 확인
```bash
cd docker
docker compose logs -f ragflow-cpu | grep -E "query|retrieval|response_time"
```

---

## 문제 해결

### 응답이 느린 경우 (> 5초)
1. Infinity 인덱스 상태 확인
2. Top K 값 줄이기 (5 → 3)
3. 메모리 부족 확인 (docker stats)

### 환각 답변이 나오는 경우
1. Temperature 더 낮추기 (0.1 → 0.05)
2. 시스템 프롬프트 강화
3. Similarity Threshold 높이기 (0.2 → 0.3)

### 출처가 표시되지 않는 경우
1. Rerank Model 설정 확인
2. Top N 값 확인 (최소 3 이상)
3. Knowledge Base 청크 존재 여부 확인

### API 키 관련 오류
1. 새 API 키 생성
2. 키 유효기간 확인
3. 권한 설정 확인

---

## 다음 단계

Phase 5 완료 후:
- **Phase 6**: 관리 및 모니터링 설정
- **최종 검증**: End-to-end 통합 테스트
- **문서화**: 운영 가이드 작성

---

**생성일**: 2025-11-16
**마지막 업데이트**: 2025-11-16
**상태**: 테스트 준비 완료
